<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SW Tailoring :: VelocityDRIVE-SP Documentation</title>
    <meta name="generator" content="Antora 3.1.9">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">VelocityDRIVE-SP Documentation</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="vd-docs" data-version="2025.03">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="doc-intro.html">Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="doc-intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="doc-getting-started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="doc-cg-relnote.html">Release note</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="doc-cg.html">Configuration Guides</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Interface</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-if-naming.html">Naming</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-if-port.html">Port</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-if-qos.html">QoS</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-if-aggr.html">Link aggregation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="doc-cg-l2.html">L2 Forwarding</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-l2-fdb.html">FDB</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-l2-vlan.html">VLAN</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-l2-mirror.html">Mirroring</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-l2-acl.html">ACL</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="doc-cg-l3.html">L3 Forwarding (routing)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">TSN</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-tsn-1588.html">PTP/IEEE1588</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-tsn-psfp.html">PSFP</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Management</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-mgmt-system.html">System</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-mgmt-ip.html">IP Based Management</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-mgmt-coap.html">Securing CoAP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-mgmt-lldp.html">LLDP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-mgmt-cy.html">CORECONF Yang</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-mgmt-fwup.html">Firmware update</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-cg-mgmt-hw.html">Hardware</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="_attachments/yang-catalog.html">Yang Catalog</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="doc-sw-packets.html">SW Packets</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="doc-sw-sbom.html">SBOM</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="doc-evb.html">EVBs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="doc-evb-lan966x.html">LAN966x EVB</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-evb-lan9662-ev09d37a.html">EVB-LAN9662-EndNode</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-evb-lan966x-fw-files.html">FW File Types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-evb-lan966x-strapping.html">Strapping Modes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-evb-lan966x-debrick.html">Flashing and Debrick</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="doc-evb-lan969x.html">LAN969x EVBs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-evb-lan969x-ev23x71a.html">EVB-LAN9696-24port</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-evb-lan969x-ev09p11a.html">EVB-LAN9692-Auto (EV09P11A)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-evb-lan969x-ev89p81a.html">EVB-LAN9698-10port (EV89P81A)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-evb-lan969x-fw-files.html">FW File Types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-evb-lan969x-strapping.html">Strapping Modes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="doc-evb-lan969x-debrick.html">Flashing and Debrick</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="doc-tailor.html">SW Tailoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="doc-tailor-getting-started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="doc-tailor-sw-variants.html">SW Variants</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="doc-tailor-boardconf.html">Board Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">SW Debugging</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="doc-dbg-trace.html">Trace</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Support tools</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="doc-sup-ct.html">VelocityDRIVE-CT</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="doc-sup-gh.html">Support Scripts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Technology</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="doc-tech-mup1.html"><code>MUP1</code></a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="doc-tech-yang.html">YANG</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="doc-tech-cc.html">CORECONF</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Documentation</span>
    <span class="version">2025.03</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="doc-intro.html">Documentation</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="doc-intro.html">2025.03</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="doc-intro.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="doc-intro.html">Documentation</a></li>
    <li><a href="doc-tailor.html">SW Tailoring</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="3">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">SW Tailoring</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The VelocityDRIVE-SP SW packets offered by Microchip support a given Switch-SoC
along with some selected peripherals (like PHYs and flash chips). But to build
a functional switch, the SoC needs to be mounted on a board, and when this board
is designed, certain decisions are made. This includes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Port map and configuration</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>What ports are used, what PHYs and what speeds</p>
</li>
<li>
<p>Physical port numbers vs serdes/rgmii numbering</p>
</li>
<li>
<p>etc.</p>
</li>
</ol>
</div>
</li>
<li>
<p>GPIO mappings</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Board reset, status LED, etc.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Factory default configuration</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Example: if the box has a label saying the default IP is 10.0.0.1, then this
configuration needs to go into the factory defaults.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>As the SW is designed to support a SoC, not a board/box, some tailoring layer is
needed where the decisions made when designing a given board (schematic) can be
augmented into the generalized SoC SW.</p>
</div>
<div class="paragraph">
<p>This is referred to as SW-tailoring and is covered in detail in this part of the
documentation. VelocityDRIVE-SP is distributed as binaries, and all the
tailoring options described here can be used on the binary packets of
VelocityDRIVE-SP. The mechanisms described here are the same as what Microchip
uses to support their own EVBs, and the EVB tailoring is included in the binary
packets as a reference example.</p>
</div>
<div class="paragraph">
<p>The board tailoring features can be boiled down to the following categories:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Board-config:</strong> also referred to as the Board-YANG because we use a YANG module
to guard the schema on what can be put into the board-config.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>This file includes all the information from the schematic of the boards,
which the SW needs to know about to be able to adjust its behavior on a
given board.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Factory defaults:</strong> This is the configuration applied if no user configuration
has been saved on the board, or if a board is being reset to factory defaults.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The factory defaults are stored in the board-config file along with the other
settings.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>EXTMOD:</strong> This is specific functionality which optionally can be provided by
the customer.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>The extmod is stored in the board-config file along with the other settings.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Secure Boot:</strong> This is about signing the artifacts with keys controlled by the
customer.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_build_process_overview"><a class="anchor" href="#_build_process_overview"></a>1. Build process overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To understand how the SW Tailoring is working, it is a good idea to look at the
build process, which show how artifacts are generated and what are the inputs,
outputs and dependencies.</p>
</div>
<div class="sect2">
<h3 id="_extmod_optional"><a class="anchor" href="#_extmod_optional"></a>1.1. EXTMOD (optional)</h3>
<div class="paragraph">
<p><code>extmod</code> is a load-able C library capable of letting the customer implement
certain function to extend or tailor the behavioral of the binary SW packet.
<code>extmod</code> is an optional component and if not needed, it can be skipped entirely.</p>
</div>
<div class="paragraph">
<p>Build-wise, this is the first step as it has no dependencies. The input here is
the C sources, which are compiled and linked using the GCC tool-chain to
generate a <code>ELF</code> file. The <code>ELF</code> file is then processed by a script which take
care of extracting only the object-code, and extract information on what region
needs to be executable (the code) and what needs to to be RW (initialized data
and BSS)</p>
</div>
<div class="paragraph">
<p>These steps are illustrated below:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/doc-tailor-build-extmod.svg" alt="doc tailor build extmod" width="60%">
</div>
</div>
<div class="paragraph">
<p>In the end a "extmod" file is generated, which contain the text and region
information. This file will be used as input in the next step.</p>
</div>
</div>
<div class="sect2">
<h3 id="_board_configuration"><a class="anchor" href="#_board_configuration"></a>1.2. Board configuration</h3>
<div class="paragraph">
<p>The board configuration, a CBOR encoded data structure including all the
tailoring configuration, data and code. The <code>docs/sw_refs/yang/board.yang</code> file
in the binary packet, provide the YANG schema documenting the individual fields.</p>
</div>
<div class="paragraph">
<p>The board configuration contains the following major sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>board:drivers</code></p>
<div class="ulist">
<ul>
<li>
<p>This list all the driver which needs to be instantiated at boot, and provide
the needed parameters. This section conceptually similar to device trees.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>board:capabilities</code></p>
<div class="ulist">
<ul>
<li>
<p>This is used to enable/disable certain features, and to control the scale and
resource consumption for a given resource.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>board:factory_default_config</code></p>
<div class="ulist">
<ul>
<li>
<p>This is the configuration to apply when the board is reset to factory
defaults.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>board:extmod</code></p>
<div class="ulist">
<ul>
<li>
<p>This is the loadable C library from previous section.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When creating the board CBOR file the following input is needed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A YAML file containing the <code>board:drivers</code>, <code>board:capabilities</code> and
<code>board:factory_default_config</code>.</p>
</li>
<li>
<p>Optionally the <code>extmod</code> file from previous section.</p>
</li>
<li>
<p>The YANG catalog with all the SID files. This is needed to convert all the
string based identifier to ID. This YANG catalog is part of the binary
packet.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>bc2cbor</code> will take these inputs, and generate the <code>board.cbor</code> file.</p>
</div>
<div class="paragraph">
<p>This process is illustrated below:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/doc-tailor-build-board-cbor.svg" alt="doc tailor build board cbor" width="60%">
</div>
</div>
<div class="paragraph">
<p>The resulting output is then used as input in the next step.</p>
</div>
</div>
<div class="sect2">
<h3 id="_image_generation"><a class="anchor" href="#_image_generation"></a>1.3. Image generation</h3>
<div class="paragraph">
<p>The final step is the image generation. Here the <code>board.cbor</code> form the earlier
step is appended to the binary, then it is signed for secure boot, and wrapped
into a FIP image.</p>
</div>
<div class="paragraph">
<p>This process is illustrated below:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/doc-tailor-build-img.svg" alt="doc tailor build img" width="80%">
</div>
</div>
<div class="paragraph">
<p>Beside form producing a FIP, an <code>img</code> file is also produced. The <code>img</code> file
contains both the bootloader and the FIP provisioned in both FW partitions. This
<code>img</code> file can be programmed directly into the flash.</p>
</div>
<div class="paragraph">
<p>The resulting image is now ready for use.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  This page was built using <a href="https://antora.org">Antora</a>
</footer>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
